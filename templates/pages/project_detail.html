{% extends "base.html" %}

{% block content %}
    <!-- Project Detail Page -->
    <div id="project-detail" class="page">
        <div class="container project-detail">
            <div class="project-slider">
                <img src="{{ project.image.url }}" alt="Project Image">
            </div>
            
            <div class="project-info">
                <div class="project-main">
                    <h1>{{ project.title }}</h1>
                    <p class="project-description" style="margin: 20px 0; font-size: 1.1rem;">
                        {{ project.description }}
                    </p>
                    
                    <div class="project-progress" style="height: 12px; margin: 30px 0;">
                        <div class="progress-bar" style="width: {{ project.funded_amount|floatformat:0 }}%;"></div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-bottom: 30px;">
                        <div>
                            <div style="font-size: 1.5rem; font-weight: bold;">£{{ project.funded_amount|floatformat:0 }}</div>
                            <div>raised of £{{ project.amount_goal|floatformat:0 }}</div>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; font-weight: bold;">{{ project.donors }}</div>
                            <div>donors</div>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; font-weight: bold;">{{ project.days_left }}</div>
                            <div>days left</div>
                        </div>
                    </div>
                        <!-- start button by paypal -->
                        <script src="https://www.paypal.com/sdk/js?client-id=AVT9wnGoDD2sEK1SzB6CldJ_VwBxvzBdkduXbzUKkWIn4ajhzHjoe6e3xQB10RgtIn2a7y43JPNp4CAG&currency=USD"></script>
                        <div id="paypal-button-container"></div>
                        <script>
                            paypal.Buttons({
                            createOrder: function(data, actions) {
                                return actions.order.create({
                                purchase_units: [{
                                    amount: {
                                    value: '{{project.funded_amount}}' 
                                    }
                                }]
                                });
                            },
                            onApprove: function(data, actions) {
                                return actions.order.capture().then(function(details) {
                                alert('تم الدفع بنجاح بواسطة: ' + details.payer.name.given_name);
                                });
                            }
                            }).render('#paypal-button-container');
                        </script>
                        <!-- end button by paypal -->
                    
                    <div style="margin-top: 40px;">
                        <h2>About this project</h2>
                        <p style="margin: 20px 0;">
                            
                        </p>
                        <p style="margin: 20px 0;">
                            {{ project.about_project }}
                        </p>
                    </div>
                    <div class="comments-section">
                        <h2>Comments ({{comments.count}})</h2>
                        {% for comment in comments %}                      
                        <div class="comment">
                            <div class="comment-header">
                                <div>
                                    <div>{{ comment.user.username }} :</div>
                                </div>
                            </div>
                            <p>{{ comment.body }}</p>
                        </div>
                        {% empty %}
                            <div>No comments yet.</div>
                        {% endfor %}
 
                        
                        <div style="margin-top: 30px;">
                            <h3>Leave a comment</h3>
                            <div class="form-group">
                            {% if user.is_authenticated %}
                                <form method="post">                                 
                                    {% csrf_token %}
                                    <textarea class="form-control" name="body" rows="3" placeholder="Write a comment..."></textarea><br>
                                    <button type="submit" class="btn btn-primary">Add Comment</button>
                                </form>
                                {% else %}
                                    <p><a href="{% url 'login' %}">Login</a> to comment.</p>
                            {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="project-sidebar">
                    <h3>Project Creator</h3>
                    <div style="display: flex; align-items: center; margin: 20px 0;">
                        <img src="{{project.image.url}}" alt="Creator" style="width: 50px; height: 50px; border-radius: 50%; margin-right: 15px;">
                        <div>
                            <div style="font-weight: bold;">{{project.owner}}</div>
                            <div>{{project.title}}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="js/main.js"></script>
</body>
</html>
{% endblock content %}


